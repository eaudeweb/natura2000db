{% set html = form_generator %}

{% macro errors(field) %}
  {% for msg in field.errors %}
    <span class="error">{{ msg }}</span>
  {% endfor -%}
{% endmacro %}

{% macro input(field) %}
  {%- do html.begin(auto_domid=true, auto_for=true) %}
  {% if not html['skip_labels'] %}
    {{ html.label(field, contents=field.properties.label) }}
  {% endif %}
  {{ html.input(field) }}
  {% if errors %}
    {{- errors(field) -}}
  {% endif %}
  {%- do html.end() %}
{% endmacro %}

{% macro radio(field) %}
  {%- do html.begin(auto_domid=true, auto_for=true) %}
  <td>
  {% for value in field.valid_values %}
    {{ html.input(field, type="radio", value=value) }}
  {% endfor %}
  {% if errors %}
    {{- errors(field) -}}
  {% endif %}
  </td>
  {%- do html.end() %}
{% endmacro %}

{% macro select(field) %}
  {{ html.select.open(field) }}
  {{ html.option(field, contents='') }}
  {% for value in field.valid_values %}
    {{ html.option(field, value=value, contents=value) }}
  {% endfor %}
  {{ html.select.close() }}
  {% if errors %}
    {{- errors(field) -}}
  {% endif %}
{% endmacro %}

{% macro textarea(field) %}
  {%- do html.begin(auto_domid=true, auto_for=true) %}
  {% if not html['skip_labels'] %}
    {{ html.label(field, contents=field.properties.label) }}
  {% endif %}
  {{ html.textarea(field) }}
  {% if errors %}
    {{- errors(field) -}}
  {% endif %}
  {%- do html.end() %}
{% endmacro %}

{% macro checkbox(field) %}
  {%- do html.begin(auto_domid=true, auto_for=true) %}
  {% if not html['skip_labels'] %}
    {{ html.label(field, contents=field.properties.label) }}
  {% endif %}
  {{ html.input(field, type="checkbox") }}
  {% if errors %}
    {{- errors(field) -}}
  {% endif %}
  {%- do html.end() %}
{% endmacro %}

{% macro dict_children(field) %}
  {%- for child_name in field.properties.order %}
  <div>
  {{ widget(field[child_name]) }}
  </div>
  {% endfor -%}
{% endmacro %}

{% macro dict(field) %}
  <p>{{ field.properties.label }}</p>
  {{ dict_children(field) }}
{% endmacro %}

{% macro list(field) %}
  {{ field.properties.label }} <br />
  {{ field.append('') or "" }}
  {{ field.append('') or "" }}
  {% for child in field %}
  {{ widget(child) }}
  {% endfor %}
{% endmacro %}

{% macro table_th(field, prefix='') %}
  {% if field.properties.order %}
    {% for child_name in field.properties.order %}
      {{ table_th(field[child_name], prefix=prefix + field[child_name].properties.label + ' - ') }}
    {% endfor %}
  {% else %}
    <td>{{ prefix[:-3] }}</td>
  {% endif %}
{% endmacro %}

{% macro table_td(field) %}
  {% if field.properties.order %}
    {% for child_name in field.properties.order %}
      {{ table_td(field[child_name]) }}
    {% endfor %}
  {% else %}
    {% do html.begin(skip_labels=True) -%}
    <td>{{ widget(field) }}</td>
    {%- do html.end() %}
  {% endif %}
{% endmacro %}

{% macro table(field) %}
  {%- do html.begin(auto_domid=true, auto_for=true) %}
  <table border=1>
    <caption>{{field.properties.label}}</caption>
    <thead>
      {{ field.append('') or "" }}
      {{ field.append('') or "" }}
      <tr>
        {{ table_th(field[0]) }}
      </tr>
    </thead>
    <tbody>
      {% for child in field %}
      <tr>
          {{ table_td(child) }}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {%- do html.end() %}
{% endmacro %}

{% macro habitat_breakdown(field) %}
  {%- do html.begin(auto_domid=true, auto_for=true) %}
  <table border=1>
    <thead>
      <tr>
        <td>{{ field.properties.label }}</td>
        <td>pondere in %</td>
      </tr>
    </thead>
    <tbody>
      {% for child_name in field.properties.order %}
      <tr>
          <td>{{ field[child_name].properties.label }}</td>
          {% do html.begin(skip_labels=True) -%}
          <td>{{ widget(field[child_name]) }}</td>
          {%- do html.end() %}
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <td>TOTAL SUPRAFATA HABITAT</td>
        <td></td>
      </tr>
    </table>
  {%- do html.end() %}
{% endmacro %}

{% macro section(field) %}
  {%- do html.begin(auto_domid=true, auto_for=true) %}
  <h2>{{ field.properties.label }}</h2>
  {{ dict_children(field) }}
  {%- do html.end() %}
{% endmacro %}
